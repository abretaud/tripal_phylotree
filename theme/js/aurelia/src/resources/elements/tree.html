<template>
  <require from="./tree.css"></require>
  <require from="resources/elements/loader-anim"></require>

	<form action="" if.bind="!api.loading">
      <fieldset>
        <span if.bind="hiddenLeavesNum">
          <button if.bind="hiddenLeavesNum" class="ui-button ui-corner-all"
						click.delegate="onReset()">
            Reset Phylogram Chart
          </button>
          ${hiddenLeavesNum} hidden terminal (leaf) nodes |
        </span>
        <label for="verticalLayout">
        <input id="verticalLayout" type="radio" name="layout" value="vertical"
					checked.bind="selectedLayout" change.delegate="onLayout()">
        <span class="label body">
          vertical layout
        </span>
        </label>
        <label for="radialLayout">
        <input id="radialLayout" type="radio" name="layout" value="radial"
          checked.bind="selectedLayout" change.delegate="onLayout()">
        <span class="label body">
           radial layout
         </span>
        </label>
        </div>
      </fieldset>
  </form>
	
	<div style="margin-top: 10px"
		    if.bind="! api.loading && hilitedFeatures">
		Jump to hilited feature:
		<a repeat.for="name of hilitedFeatures | keys"
			 click.delegate="onScrollToHilite(name)">
			${name}
		</a>
	</div>
		
  <div id="tree-chart" class="svg-container" ref="phylogramElement">
  </div>
		
		<div id="node-dialog" ref="nodeDialogEl" style="display: none">

			<div if.bind="node.is_leaf() && ! node.is_collapsed()">
				<!-- leaf node linkouts -->

				<div repeat.for="link of node.linkouts">
					<a href.bind="link.href" tabindex="-1">
						${link.text}
					</a>
				</div>
			</div>
			
			<div if.bind="! node.is_leaf() || node.is_collapsed()">
				<a class="link" href="#" click.delegate="onNodeToggle()" tabindex="-1">
					<span if.bind="node.is_collapsed()">
						Expand
					</span>
					<span if.bind="! node.is_collapsed()">
						Collapse
					</span>
					subtree at this node
				</a>
				<div if.bind="node.legumes.length">
					<!-- interior node linkouts -->
					<div repeat.for="link of node.linkouts">
						<a href.bind="link.href" tabindex="-1">
							${link.text}
						</a>
					</div>
					<!-- cmtv link out -->
					<a id="cmtv_link_out"
						tabindex="-1"
						href="http://velarde.ncgr.org:7070/isys/launch?svc=org.ncgr.cmtv.isys.CompMapViewerService%40--style%40http://velarde.ncgr.org:7070/isys/bin/Components/cmtv/conf/cmtv_combined_map_style.xml%40--combined_display%40${window.location.origin}/lis_gene_families/chado/phylo/node/gff_download/${node.data().phylonode_id}">
						View Genomic Distribution for genes in this subtree
					</a>
				</div>
				<div if.bind="! node.legumes.length">
					<small>(No additional resources are available for this
						sub-tree. Please try another node.)</small>
				</div>
			</div>
			<div if.bind="node.is_leaf() && ! node.is_collapsed()">
				<!-- add a tripal organism link, if this is a leaf node and
				organism is known. -->
				<div if.bind="node.data().organism_node_id">
					<a id="organism_link"
						href="/node/${node.data().organism_node_id}"
						tabindex="-1">
						view organism: ${node.data().genus} ${node.data().species}
						<span if.bind="node.data().common_name">
							(${node.data().common_name})
						</span>
					</a>
				</div>
				<!--  add a tripal feature link, if this is a leaf node and the
				feature is known. -->
				<div if.bind="node.data().feature_node_id">
					<a id="feature_link"
						href="/node/${node.data().feature_node_id}"
						tabindex="-1">
						view feature: ${node.data().feature_name}
					</a>
				</div>
			</div>
			<loader-anim if.bind="loading"></loader-anim>
		</div>
			
</template>
