define("api",["exports","aurelia-framework","aurelia-fetch-client","crossfilter2"],function(t,e,i,n){"use strict";function o(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e,i,n,o){var a={};return Object.keys(n).forEach(function(t){a[t]=n[t]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce(function(i,n){return n(t,e,i)||i},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(t,e,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t.Api=void 0;var s,l,u,d,c,h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),f=h.default;msa.io.fasta,t.Api=(s=(0,e.inject)(i.HttpClient))((u=function(){function t(e){a(this,t),this.TREE_URL=API.tree,this.MSA_URL=API.msa,this.FAMREPS_LINKS_URL="/famreps_links",this.LEAF_LINKS_URL="/phylotree_links/",o(this,"cf",d,this),o(this,"cfUpdated",c,this),this.treeData=null,this.msaSeqs=null,this.loading=!0,this.flatData=[],this.index={},this.http=e}return t.prototype.init=function(){var t=this,e=this.getTreeData(),i=this.getMsaData();return Promise.all([e,i]).then(function(){t.loading=!1,t.postProcess(),t.setupCrossFilter()})},t.prototype.getConsensusSeq=function(){return this.msaSeqs[0].name.endsWith("-consensus")?this.msaSeqs[0]:void 0},t.prototype.setupCrossFilter=function(){this.cf=f(this.flatData)},t.prototype.getTreeData=function(){var t=this;return treeData?(this.treeData=treeData,this.parseTree(treeData),Promise.resolve(treeData)):this.http.fetch(this.TREE_URL).then(function(t){return t.json()}).then(function(e){return t.treeData=e,t.parseTree(e),t.treeData})},t.prototype.getMsaData=function(){},t.prototype.postProcess=function(){var t=this;_.forEach(this.msaSeqs,function(e){if(e.seq&&e.name){var i=t.index[e.name];i&&(i.msa=e)}})},t.prototype.parseTree=function(t){var e=this;if(t.name?this.index[t.name]=t:t.name="","length"in t&&(t.branch_length=t.length),!t.children||0===t.children.length)return void this.flatData.push(t);_.each(t.children,function(i){i.parent=t,e.parseTree(i)})},t.prototype.getLinkouts=function(t){var e=t.data();if(t.is_leaf()&&!t.is_collapsed()){var i=""+this.LEAF_LINKS_URL+e.genus+"/"+e.species+"/"+e.feature_name+"/json";return this.http.fetch(i).then(function(t){return t.json()})}if(t.legumes.length>0){var n=this.FAMREPS_LINKS_URL,o="famreps="+t.legumes.map(function(t){return t.data().feature_name}).join(",");return this.http.fetch(n,{method:"post",body:o,headers:{"content-type":"application/x-www-form-urlencoded"}}).then(function(t){return t.json()})}return Promise.resolve([])},t}(),d=r(u.prototype,"cf",[e.observable],{enumerable:!0,initializer:null}),c=r(u.prototype,"cfUpdated",[e.observable],{enumerable:!0,initializer:null}),l=u))||l}),define("app",["exports","aurelia-framework","aurelia-fetch-client","api"],function(t,e,i,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;var a,r,s=jQuery;t.App=(a=(0,e.inject)(n.Api,i.HttpClient))(r=function(){function t(e,i){o(this,t),this.tools={taxon:!1,msa:!1,help:!1},this.treeData=null,this.msaData=null,this.familyName=FAMILY_NAME,this.api=e,this.http=i}return t.prototype.attached=function(){this.configureHttpClient(),this.api.init().then(function(){s("#ajax-spinner").remove()})},t.prototype.configureHttpClient=function(){this.http.configure(function(t){t.withDefaults({credentials:"same-origin",headers:{Accept:"application/json","X-Requested-With":"Fetch","Cache-Control":"no-cache",Pragma:"no-cache","If-Modified-Since":"Mon, 26 Jul 1997 05:00:00 GMT"}}).withInterceptor({response:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){if(!t.ok){var e="HTTP "+t.status+": "+t.statusText+" [ "+t.url+" ]";throw console.error(e),alert(e),t}return t}),requestError:function(t){if(response instanceof TypeError){var e="A network error was encountered: browser offline, DNS lookup failure, or connection refused: ["+response+"]";console.error(e),alert(e)}else{var i="Fetch request error: "+t;console.error(i),alert(i)}throw t},responseError:function(t){if(t instanceof TypeError){var e="A network error was encountered: browser offline, DNS lookup failure, or connection refused: ["+t+"]";console.error(e),alert(e)}else{var i="Fetch response error: "+t;console.error(i),alert(i)}throw t}})})},t.prototype.toggleHelp=function(){this.tools.help=!this.tools.help},t.prototype.toggleTaxon=function(){this.tools.taxon=!this.tools.taxon;var t=s("#taxon-dialog"),e=this.tools.taxon?"open":"close";t.dialog(e)},t.prototype.toggleMSA=function(){this.tools.msa=!this.tools.msa;var t=s("#msa-dialog"),e=this.tools.msa?"open":"close";t.dialog(e)},t}())||r}),define("environment",["exports"],function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={debug:!1,testing:!1}}),define("main",["exports","./environment","./polyfill/index"],function(t,e){"use strict";function i(t){t.use.defaultBindingLanguage().defaultResources().feature("resources"),n.default.debug&&t.use.developmentLogging(),n.default.testing&&t.use.plugin("aurelia-testing"),t.start().then(function(){return t.setRoot()})}Object.defineProperty(t,"__esModule",{value:!0}),t.configure=i;var n=function(t){return t&&t.__esModule?t:{default:t}}(e);Promise.config({warnings:{wForgottenReturn:!1}})}),define("symbology",["exports","taxon-chroma"],function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Symbology=void 0;t.Symbology=function(){function t(){i(this,t),this.legumes=e.taxonChroma.legumeGenera,this.OPTS={overrides:{"arachis ipaensis":"rgb(170, 171, 0)"}}}return t.prototype.color=function(t){return e.taxonChroma.get(t,this.OPTS)},t}()}),define("taxon-chroma",["exports"],function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e={};(function(){function t(t,e){for(var i=2166136261,n=0;n<t.length;++n)i^=t.charCodeAt(n),i+=(i<<1)+(i<<4)+(i<<7)+(i<<8)+(i<<24);return(i>>>0)%e}var e={},i=chroma.brewer.Set2;this.defaultColor="#d3d3d3",this.legumeGenera={apios:i[0],arachis:"#bcbd22",cajanus:"#ffbb78",chamaecrista:i[5],cicer:"#2ca02c",glycine:"#1f77b4",lens:"#98df8a",lotus:"#17becf",lupinus:"#ff9896",medicago:"#8c564b",phaseolus:"#e377c2",pisum:"#f7b6d2",trifolium:i[2],"*user":"#990000",vicia:i[4],vigna:"#d62728"},this.get=function(i,n){if(i=i.toLowerCase(),n||(n={}),void 0===n.lightnessFactor&&(n.lightnessFactor=1),void 0===n.overrides&&(n.overrides={}),void 0!==n.overrides[i])return n.overrides[i];if(void 0!==e[i])return e[i];var o=null,a=i.split(" "),r=a[0],s=a[1];if(r in this.legumeGenera){var l=this.legumeGenera[r],u=chroma(l).hsl()[0],d=.3+t(s,1e3)/1e3*.4;o=chroma(u,1,d*n.lightnessFactor,"hsl").hex()}else o=this.defaultColor;return e[i]=o,o}}).call(e),t.taxonChroma=e}),define("polyfill/MutationObserver",[],function(){"use strict";!function(t){function e(t){_.push(t),y||(y=!0,m(n))}function i(t){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(t)||t}function n(){y=!1;var t=_;_=[],t.sort(function(t,e){return t.uid_-e.uid_});var e=!1;t.forEach(function(t){var i=t.takeRecords();o(t),i.length&&(t.callback_(i,t),e=!0)}),e&&n()}function o(t){t.nodes_.forEach(function(e){var i=g.get(e);i&&i.forEach(function(e){e.observer===t&&e.removeTransientObservers()})})}function a(t,e){for(var i=t;i;i=i.parentNode){var n=g.get(i);if(n)for(var o=0;o<n.length;o++){var a=n[o],r=a.options;if(i===t||r.subtree){var s=e(r);s&&a.enqueue(s)}}}}function r(t){this.callback_=t,this.nodes_=[],this.records_=[],this.uid_=++x}function s(t,e){this.type=t,this.target=e,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function l(t){var e=new s(t.type,t.target);return e.addedNodes=t.addedNodes.slice(),e.removedNodes=t.removedNodes.slice(),e.previousSibling=t.previousSibling,e.nextSibling=t.nextSibling,e.attributeName=t.attributeName,e.attributeNamespace=t.attributeNamespace,e.oldValue=t.oldValue,e}function u(t,e){return w=new s(t,e)}function d(t){return N||(N=l(w),N.oldValue=t,N)}function c(){w=N=void 0}function h(t){return t===N||t===w}function f(t,e){return t===e?t:N&&h(t)?N:null}function p(t,e,i){this.observer=t,this.target=e,this.options=i,this.transientObservedNodes=[]}if(!t.JsMutationObserver){var m,g=new WeakMap;if(/Trident|Edge/.test(navigator.userAgent))m=setTimeout;else if(window.setImmediate)m=window.setImmediate;else{var b=[],v=String(Math.random());window.addEventListener("message",function(t){if(t.data===v){var e=b;b=[],e.forEach(function(t){t()})}}),m=function(t){b.push(t),window.postMessage(v,"*")}}var y=!1,_=[],x=0;r.prototype={observe:function(t,e){if(t=i(t),!e.childList&&!e.attributes&&!e.characterData||e.attributeOldValue&&!e.attributes||e.attributeFilter&&e.attributeFilter.length&&!e.attributes||e.characterDataOldValue&&!e.characterData)throw new SyntaxError;var n=g.get(t);n||g.set(t,n=[]);for(var o,a=0;a<n.length;a++)if(n[a].observer===this){o=n[a],o.removeListeners(),o.options=e;break}o||(o=new p(this,t,e),n.push(o),this.nodes_.push(t)),o.addListeners()},disconnect:function(){this.nodes_.forEach(function(t){for(var e=g.get(t),i=0;i<e.length;i++){var n=e[i];if(n.observer===this){n.removeListeners(),e.splice(i,1);break}}},this),this.records_=[]},takeRecords:function(){var t=this.records_;return this.records_=[],t}};var w,N;p.prototype={enqueue:function(t){var i=this.observer.records_,n=i.length;if(i.length>0){var o=i[n-1],a=f(o,t);if(a)return void(i[n-1]=a)}else e(this.observer);i[n]=t},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(t){var e=this.options;e.attributes&&t.addEventListener("DOMAttrModified",this,!0),e.characterData&&t.addEventListener("DOMCharacterDataModified",this,!0),e.childList&&t.addEventListener("DOMNodeInserted",this,!0),(e.childList||e.subtree)&&t.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(t){var e=this.options;e.attributes&&t.removeEventListener("DOMAttrModified",this,!0),e.characterData&&t.removeEventListener("DOMCharacterDataModified",this,!0),e.childList&&t.removeEventListener("DOMNodeInserted",this,!0),(e.childList||e.subtree)&&t.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(t){if(t!==this.target){this.addListeners_(t),this.transientObservedNodes.push(t);var e=g.get(t);e||g.set(t,e=[]),e.push(this)}},removeTransientObservers:function(){var t=this.transientObservedNodes;this.transientObservedNodes=[],t.forEach(function(t){this.removeListeners_(t);for(var e=g.get(t),i=0;i<e.length;i++)if(e[i]===this){e.splice(i,1);break}},this)},handleEvent:function(t){switch(t.stopImmediatePropagation(),t.type){case"DOMAttrModified":var e=t.attrName,i=t.relatedNode.namespaceURI,n=t.target,o=new u("attributes",n);o.attributeName=e,o.attributeNamespace=i;var r=t.attrChange===MutationEvent.ADDITION?null:t.prevValue;a(n,function(t){if(t.attributes&&(!t.attributeFilter||!t.attributeFilter.length||-1!==t.attributeFilter.indexOf(e)||-1!==t.attributeFilter.indexOf(i)))return t.attributeOldValue?d(r):o});break;case"DOMCharacterDataModified":var n=t.target,o=u("characterData",n),r=t.prevValue;a(n,function(t){if(t.characterData)return t.characterDataOldValue?d(r):o});break;case"DOMNodeRemoved":this.addTransientObserver(t.target);case"DOMNodeInserted":var s,l,h=t.target;"DOMNodeInserted"===t.type?(s=[h],l=[]):(s=[],l=[h]);var f=h.previousSibling,p=h.nextSibling,o=u("childList",t.target.parentNode);o.addedNodes=s,o.removedNodes=l,o.previousSibling=f,o.nextSibling=p,a(t.relatedNode,function(t){if(t.childList)return o})}c()}},t.JsMutationObserver=r,t.MutationObserver||(t.MutationObserver=r,r._isPolyfilled=!0)}}(self)}),define("polyfill/index",["raf","fetch","./MutationObserver"],function(t){"use strict";(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e})(t).polyfill()}),define("resources/index",["exports"],function(t){"use strict";function e(t){}Object.defineProperty(t,"__esModule",{value:!0}),t.configure=e}),define("resources/elements/help",["exports","aurelia-framework"],function(t,e){"use strict";function i(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Help=void 0;var o,a,r=jQuery;t.Help=(o=function(){function t(){n(this,t),i(this,"showDialog",a,this)}return t.prototype.showDialogChanged=function(t,e){this.showDialog=t,(t||null!==e)&&this.update()},t.prototype.update=function(){var t=this;this.dialog||(this.dialog=r("#help-dialog"));var e={title:"Gene Family Help",closeOnEscape:!0,modal:!1,close:function(e,i){return t.closed()}};this.dialog.dialog(e);var i=this.showDialog?"open":"close";this.dialog.dialog(i)},t.prototype.closed=function(){this.showDialog=!1},t.prototype.onTour=function(){this.showDialog=!1,lisTours.go("phylotree")},t}(),a=function(t,e,i,n,o){var a={};return Object.keys(n).forEach(function(t){a[t]=n[t]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce(function(i,n){return n(t,e,i)||i},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(t,e,a),a=null),a}(o.prototype,"showDialog",[e.bindable],{enumerable:!0,initializer:null}),o)}),define("resources/elements/loader-anim",["exports"],function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.LoaderAnim=function t(){e(this,t)}}),define("resources/elements/msa",["exports","aurelia-framework","api","app"],function(t,e,i,n){"use strict";function o(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e,i,n,o){var a={};return Object.keys(n).forEach(function(t){a[t]=n[t]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce(function(i,n){return n(t,e,i)||i},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(t,e,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t.Msa=void 0;var s,l,u,d,c,h,f,p,m=jQuery;t.Msa=(s=(0,e.inject)(n.App,i.Api,e.BindingEngine))((u=function(){function t(e,i,n){a(this,t),this.MAX_HEIGHT=175,this.DIALOG_WIDTH=650,this.MSA_LABEL_WIDTH=150,this.MSA_LABEL_FONT_SIZE=9,this.MSA_ZOOMER_WIDTH=475,o(this,"familyName",d,this),o(this,"showDialog",c,this),o(this,"treeEl",h,this),o(this,"selectedFeatureNames",f,this),o(this,"selectedFeatureNum",p,this),this.menu=!1,this._msa=null,this.msaDirty=!1,this.dialog=null,this.tree=null,this.seqs=[],this.index={},this._dim=null,this.app=e,this.api=i,this.be=n}return t.prototype.attached=function(){this.tree=this.treeEl.au.controller.viewModel,this.dialog=m("#msa-dialog"),this.subscribe()},t.prototype.showDialogChanged=function(t,e){this.showDialog=t,this.showDialog&&!this._msa&&(this.init(),this.updateMsa()),this.dialog&&this.updateDialog()},t.prototype.init=function(t){var e=t?t.width-this.MSA_LABEL_WIDTH-25:this.MSA_ZOOMER_WIDTH;this.seqs=this.api.msaSeqs;var i={el:this.msaElement,bootstrapMenu:!0,vis:{overviewbox:!1,labelId:!1},zoomer:{labelNameLength:this.MSA_LABEL_WIDTH,labelFontsize:this.MSA_LABEL_FONT_SIZE,alignmentWidth:e,autoResize:!0}};this._msa=msa(i);var n={reset:this.onMsaSelectionReset,add:this.onMsaSelectionAdd};this._msa.g.selcol.on(n,this),m(".smenubar_alink").live("click",function(t){setTimeout(function(){var t=m(".smenu-dropdown");t.css("top",""),t.css("left","")})})},t.prototype.updateDialog=function(){var t=this;this.showDialog&&this.msaDirty&&this.updateMsa();var e={title:"Multiple Sequence Alignment - "+this.familyName,closeOnEscape:!0,modal:!1,width:this.DIALOG_WIDTH+"px",position:{my:"right",at:"bottom"},close:function(e,i){return t.onDialogClosed()},resizeStop:function(e,i){return t.onDialogResized(i.size)}};this.dialogWasOpened&&delete e.position,this.dialog.dialog(e);var i=this.showDialog?"open":"close";this.dialog.dialog(i),this.dialogWasOpened=!0},t.prototype.onDialogResized=function(t){var e=t.width-this.MSA_LABEL_WIDTH-25;this._msa.g.zoomer.attributes.alignmentWidth=e,this._msa.render()},t.prototype.onDialogClosed=function(){this.onClearSelection(),this.showDialog=!1},t.prototype.subscribe=function(){var t=this;this.be.propertyObserver(this.api,"cf").subscribe(function(e){return t.onCfCreated(e)}),this.be.propertyObserver(this.api,"cfUpdated").subscribe(function(e){return t.onCfUpdated(e)})},t.prototype.onCfCreated=function(t){this._cf=t,this._dim=t.dimension(function(t){return t.name})},t.prototype.onCfUpdated=function(t){t.sender!=this&&(this.showDialog?this.updateMsa():this.msaDirty=!0)},t.prototype.updateMsa=function(){var t=this._dim.top(1/0),e=_.map(t,function(t){return t.msa}),i=this.tree.getSortOrder();e=_.sortBy(e,function(t){return i.indexOf(t.name)}),e.unshift(this.api.getConsensusSeq()),this.display(e),this.msaDirty=!1},t.prototype.display=function(t){this._msa.seqs.reset(t),this._msa.render();var e=15*t.length,i=e>this.MAX_HEIGHT?this.MAX_HEIGHT:e;this._msa.g.zoomer.set("alignmentHeight",i),this.menu?m("div.smenubar").show():m("div.smenubar").hide()},t.prototype.onToggleMenu=function(){this.menu=!this.menu,this.menu?m("div.smenubar").show():m("div.smenubar").hide()},t.prototype.onMsaSelectionAdd=function(t,e){var i=this,n=_.map(t.collection.models,function(t){return t.attributes.seqId}),o=this._msa.seqs.filter(function(t){return-1!==n.indexOf(t.id)}),a=_.map(o,function(t){return t.attributes.name});this.selectedFeatureNames={},_.each(a,function(t){return i.selectedFeatureNames[t]=!0}),this.selectedFeatureNum=_.size(this.selectedFeatureNames)},t.prototype.onMsaSelectionReset=function(t,e){if(t.models.length){var i=t.models[0].attributes.seqId,n=this._msa.seqs.filter(function(t){return t.id===i});if(n.length){var o=n[0].attributes.name;this.selectedFeatureNames={},this.selectedFeatureNames[o]=!0}}this.selectedFeatureNum=_.size(this.selectedFeatureNames)},t.prototype.onClearSelection=function(){this._msa.g.selcol.reset([]),this.selectedFeatureNum=0,this.selectedFeatureNames={}},t}(),d=r(u.prototype,"familyName",[e.bindable],{enumerable:!0,initializer:null}),c=r(u.prototype,"showDialog",[e.bindable],{enumerable:!0,initializer:null}),h=r(u.prototype,"treeEl",[e.bindable],{enumerable:!0,initializer:null}),f=r(u.prototype,"selectedFeatureNames",[e.observable],{enumerable:!0,initializer:function(){return{}}}),p=r(u.prototype,"selectedFeatureNum",[e.observable],{enumerable:!0,initializer:function(){return 0}}),l=u))||l}),define("resources/elements/taxon",["exports","aurelia-framework","api","symbology","app"],function(t,e,i,n,o){"use strict";function a(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e,i,n,o){var a={};return Object.keys(n).forEach(function(t){a[t]=n[t]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce(function(i,n){return n(t,e,i)||i},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(t,e,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t.Taxon=void 0;var l,u,d,c,h,f=jQuery;t.Taxon=(l=(0,e.inject)(o.App,i.Api,n.Symbology,e.BindingEngine))((d=function(){function t(e,i,n,o){r(this,t),this.ANIM_MS=50,this.DOUBLECLICK_MS=500,this.DIALOG_WIDTH="520px",a(this,"familyName",c,this),a(this,"showDialog",h,this),this._chart=null,this._cf=null,this._dim=null,this._grp=null,this.chartDirty=!1,this.app=e,this.api=i,this.symbology=n,this.be=o}return t.prototype.attached=function(){this.dialog=f(this.taxonEl),this.initNvD3Graph(),this.subscribe()},t.prototype.initNvD3Graph=function(){var t=this,e=this;nv.addGraph(function(){var i=t._chart=nv.models.pieChart().x(function(t){return t.label}).y(function(t){return t.value}).showLabels(!0).labelThreshold(.05).labelType("percent").donut(!0).donutRatio(.35).color(function(e){return t.symbology.color(e.label)});return i.options({legendPosition:"right",duration:t.ANIM_MS}),i.margin({left:0,right:0,top:0,bottom:0}),i.dispatch.on("stateChange",function(i){e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=null),e.timeoutId=setTimeout(function(){return t.onTaxonStateChange(i)},t.ANIM_MS)}),i})},t.prototype.subscribe=function(){var t=this;this.be.propertyObserver(this.api,"cf").subscribe(function(e){return t.onCfCreated(e)}),this.be.propertyObserver(this.api,"cfUpdated").subscribe(function(e){return t.onCfUpdated(e)})},t.prototype.setupCrossfilter=function(){this._dim=this._cf.dimension(function(t){return t.species?t.genus+" "+t.species:""}),this._grp=this._dim.group()},t.prototype.onTaxonStateChange=function(t){var e=this;this.chartDirty=!1;var i={};_.each(t.disabled,function(t,n){var o=e._data[n],a=o.label;i[a]=t,t&&(e.chartDirty=!0)}),this._dim.filter(null),this._dim.filter(function(t){var e=i[t];return void 0===e||!1===e}),this.api.cfUpdated={sender:this}},t.prototype.onCfCreated=function(t){this._cf=t,this.setupCrossfilter(),this.updateTaxaChart(),this.updateDialog()},t.prototype.onCfUpdated=function(t){t.sender!=this&&this.showDialog&&this.updateTaxaChart()},t.prototype.updateDialog=function(){var t=this,e={title:"Taxa - "+this.familyName,closeOnEscape:!0,modal:!1,width:this.DIALOG_WIDTH,position:{my:"left",at:"bottom"},close:function(e,i){return t.closed()}};this.dialogWasOpened&&delete e.position,this.dialog.dialog(e);var i=this.showDialog?"open":"close";this.dialog.dialog(i),this.dialogWasOpened=!0,this.showDialog&&this.updateTaxaChart()},t.prototype.showDialogChanged=function(t,e){this.showDialog=t,this.dialog&&this.updateDialog()},t.prototype.closed=function(){this.onResetChart(),this.showDialog=!1},t.prototype.updateTaxaChart=function(){var t=this._grp.all();t=_.filter(t,function(t){return t.value>0}),this._data=_.map(t,function(t){return{label:t.key,value:t.value}}),d3.select(this.taxonSvgEl).datum(this._data).transition().duration(this.ANIM_MS).call(this._chart),this._chart.legend.updateState(),this.chartDirty=!1},t.prototype.onResetChart=function(){this._dim.filter(null),this.updateTaxaChart(),this.api.cfUpdated={sender:this}},t}(),c=s(d.prototype,"familyName",[e.bindable],{enumerable:!0,initializer:function(){return null}}),h=s(d.prototype,"showDialog",[e.bindable],{enumerable:!0,initializer:null}),u=d))||u}),define("resources/elements/tree",["exports","aurelia-framework","api","symbology","biojs-io-newick"],function(t,e,i,n,o){"use strict";function a(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e,i,n,o){var a={};return Object.keys(n).forEach(function(t){a[t]=n[t]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce(function(i,n){return n(t,e,i)||i},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(t,e,a),a=null),a}Object.defineProperty(t,"__esModule",{value:!0}),t.KeysValueConverter=t.Tree=void 0;var l,u,d,c,h,f,p=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(o),m=jQuery;t.Tree=(l=(0,e.inject)(i.Api,e.BindingEngine,n.Symbology))((d=function(){function t(e,i,n){r(this,t),this.WIDTH=window.innerWidth-200,this.DURATION_MS=300,this.LABEL_HEIGHT="10px",this.LABEL_BASELINE_SHIFT="30%",this.AXIS_TICKS=12,this.AXIS_SAMPLE_PX=30,a(this,"familyName",c,this),a(this,"msaEl",h,this),a(this,"showDialog",f,this),this.msa=null,this.selectedLayout="vertical",this.hiliteFeatures={},this.node=null,this.loading=!1,this.newickExport=null,this.rootNodeDirty=!1,this.showSingletonNodes=!0,this.singletonNodeNum=0,this._rootNode=null,this._tree=null,this._cf=null,this._dims={},this._grps={},this.api=e,this.be=i,this.symbology=n}return t.prototype.attached=function(){this.msa=this.msaEl.au.controller.viewModel,this.initHiliteFeatures(),this.subscribe()},t.prototype.initHiliteFeatures=function(){var t=(0,e.parseQueryString)(window.location.search);if(!1 in t)return this.hiliteFeatures={},void(this.hiliteFeaturesCount=0);"string"==typeof t.hilite_node&&(-1!==t.hilite_node.indexOf(",")?t.hilite_node=t.hilite_node.split(","):t.hilite_node=[t.hilite_node]);var i=_.map(t.hilite_node,function(t){return t.toLowerCase()}),n=_.map(i,function(t){return!0});this.hiliteFeatures=_.zipObject(i,n),this.hiliteFeaturesCount=i.length},t.prototype.decorateLeafNodes=function(){var t=this;d3.selectAll("#phylogram .leaf.tnt_tree_node").filter(function(e){return t.isLegume(e)}).classed("legume",!0)},t.prototype.decorateSingletonNodes=function(){var t=this;this.singletonNodeNum=0,d3.selectAll("#phylogram .inner.tnt_tree_node").classed("singleton-node",function(e){return e.singleton=e.children&&1===e.children.length,e.singleton&&(t.singletonNodeNum+=1),e.singleton}).filter(function(t){return t.singleton}).classed("singleton-node-visible",this.showSingletonNodes),0===this.singletonNodeNum&&d3.selectAll("#phylogram g.singleton-node").classed("singleton-node",!1).classed("singleton-node-visible",!1)},t.prototype.onShowSingletonNodes=function(t){d3.selectAll("#phylogram .singleton-node").classed("singleton-node-visible",t)},t.prototype.subscribe=function(){var t=this;this.be.propertyObserver(this.api,"cf").subscribe(function(e){return t.onCfCreated(e)}),this.be.propertyObserver(this.api,"cfUpdated").subscribe(function(e){return t.onCfUpdated(e)}),this.be.propertyObserver(this.msa,"selectedFeatureNames").subscribe(function(e){return t.onMsaSelectionChange(e)})},t.prototype.onMsaSelectionChange=function(t,e){var i=_.keys(t);i=_.map(i,function(t){return t.toLowerCase()}),i=_.filter(i,function(t){return-1===t.indexOf("consensus")});var n=_.map(i,function(){return!0});this.hiliteFeatures=_.zipObject(i,n),this.hiliteFeaturesCount=i.length,this._tree.update_nodes(),this.updateLeafNodeHilite(!1)},t.prototype.updateLeafNodeHilite=function(t){var e=this;d3.selectAll("text.tnt_tree_label").filter(function(t){return t.name.toLowerCase()in e.hiliteFeatures}).each(function(t){t.bbox=this.getBBox()});var i=1/0;d3.selectAll("g.tnt_tree_node").filter(function(t){return t.name.toLowerCase()in e.hiliteFeatures}).insert("svg:rect",":first-child").attr("x",function(t){return"end"===t.textAnchor?t.bbox.x+t.bbox.width+10:t.bbox.x+10}).attr("y",function(t){return t.bbox.y/2}).attr("width",function(t){return t.bbox.width+2}).attr("height",function(t){return t.bbox.height+1}).attr("class","hilite-node").each(function(){var t=m(this).offset();t.top>0&&t.top<i&&(i=t.top)}),t&&_.keys(this.hiliteFeatures).length&&m("html,body").attr("scrollTop",i-100)},t.prototype.onScrollToHilite=function(t){var e=this._tree.root().find_node(function(e){return e.node_name().toLowerCase()===t}),i=e.property("_id"),n="#tnt_tree_node_phylogram_"+i,o=m(n).offset();m("html,body").attr("scrollTop",o.top-100)},t.prototype.onCfCreated=function(t){this._cf=t,this._dim=t.dimension(function(t){return t.name}),this.init()},t.prototype.onCfUpdated=function(t){t.sender!=this&&this.update()},t.prototype.init=function(){var t=this;this.WIDTH=this.phylogramElement.clientWidth-200;var e=this;this._tree=tnt.tree().data(this.api.treeData).duration(this.DURATION_MS).layout(tnt.tree.layout.vertical().width(this.WIDTH).scale(!0)),this._rootNode=this._tree.root();var i=this._tree.node_display();i.size(6),i.fill(function(e){return t.getNodeColor(e)}),this._tree.node_display(i);var n=tnt.tree.label.text();n.display(function(t,i){var n=t.data(),o=n.name.toLowerCase()in e.hiliteFeatures;return d3.select(this).append("text").text(function(t){return t.name}).style("font-size",e.LABEL_HEIGHT).style("font-weight",function(t){return o?"bold":"normal"}).style("baseline-shift",e.LABEL_BASELINE_SHIFT).style("fill","#000").attr("text-anchor",function(t){return t.textAnchor="radial"===i?t.x%360<180?"start":"end":"start",t.textAnchor})}),this._tree.label(n),this._tree.on("click",function(e){return t.onTreeNodeClick(e)}),this._tree.on("mouseover",function(e){return t.onNodeMouseover(e)}),this._tree.on("mouseout",function(e){return t.onNodeMouseout(e)}),this._tree(this.phylogramElement);var o=this._tree.scale_bar(this.AXIS_SAMPLE_PX,"pixel");d3.select(this.phylogramAxisElement).insert("svg").attr("width",this.WIDTH).attr("height",40).append("g").attr("transform","translate(20,20)").attr("class","x axis").call(this.getXAxis(o)),this.decorateLeafNodes(),_.keys(this.hiliteFeatures).length&&this.updateLeafNodeHilite(!0)},t.prototype.getXAxis=function(t){var e=t||this._tree.scale_bar(this.AXIS_SAMPLE_PX,"pixel"),i=d3.scale.linear().domain([0,e*this.WIDTH/this.AXIS_SAMPLE_PX]).range([0,this.WIDTH]);return d3.svg.axis().scale(i).ticks(this.AXIS_TICKS).orient("bottom")},t.prototype.updateXAxis=function(){d3.selectAll("#phylogram-axis g.x.axis").call(this.getXAxis())},t.prototype.node2jquery=function(t){var e=this.node2jquerySelector(t);return m(e)},t.prototype.node2jquerySelector=function(t){return"#tnt_tree_node_phylogram_"+t.id()},t.prototype.onNodeMouseover=function(t){this.node2jquery(t).attr("cursor","pointer")},t.prototype.onNodeMouseout=function(t){this.node2jquery(t).attr("cursor","default")},t.prototype.getNodeColor=function(t){if(t.is_leaf()&&!t.is_collapsed()){var e=t.data();return this.symbology.color(e.genus+" "+e.species)}},t.prototype.isLegume=function(t){if(!t.genus)return!1;var e=this.symbology.legumes;return t.genus.toLowerCase()in e},t.prototype.onTreeNodeClick=function(t){var e=this;this.loading=!0;var i=this;this.node=t,this.node.legumes=_.filter(t.get_all_leaves(!0),function(t){return e.isLegume(t.data())}),this.api.getLinkouts(t).then(function(t){i.node.linkouts=t,i.loading=!1});var n=m(this.nodeDialogEl),o={title:null,closeOnEscape:!0,modal:!1,position:{my:"center",at:"center",of:this.node2jquery(t)},show:{effect:"blind",direction:"down",duration:100}};t.is_collapsed()?o.title="collapsed subtree":t.is_leaf()?o.title=t.node_name():o.title="interior node",setTimeout(function(){return n.dialog(o)})},t.prototype.onNodeToggle=function(){var t=this;m(this.nodeDialogEl).dialog("close"),this.node.toggle(),this._tree.update(),this.updateLeafNodeHilite(!1),setTimeout(function(){t.updateXAxis(),t.updateFilter()},this.DURATION_MS)},
t.prototype.onNodeFocusTree=function(){var t=this;m(this.nodeDialogEl).dialog("close");var e=this.node;e.apply(function(t){t.is_collapsed()&&t.toggle()});var i=e.get_all_leaves(void 0),n=this._tree.root().subtree(i,!0);this._tree.data(n.data()),this._rootNode=this._tree.root(),this.rootNodeDirty=!0,this._tree.update(),this.updateLeafNodeHilite(!1),this.decorateSingletonNodes(),this.hiddenLeavesNum=0,setTimeout(function(){t.updateXAxis(),t.updateFilter()},this.DURATION_MS)},t.prototype.updateFilter=function(){var t=this._tree.root(),e=t.get_all_leaves(!0),i=t.get_all_leaves(!1);this.hiddenLeavesNum=e.length-i.length,this.hiddenLeavesNum>0&&(this.hiddenLeavesNum+=1);var n={};_.forEach(i,function(t){var e=t.data().name;e&&(n[e]=!0)}),this._dim.filterAll(),this._dim.filterFunction(function(t){return n[t]}),this.api.cfUpdated={sender:this}},t.prototype.update=function(){this._tree.data(this._rootNode.data());var t=this._dim.top(1/0),e=_.map(t,function(t){return t.name}),i=_.keyBy(e,function(t){return t}),n=this._tree.root(),o=n.find_all(function(t){return i[t.node_name()]},!0),a=n.subtree(o,!0);this._tree.data(a.data()),this._tree.update(),this.updateLeafNodeHilite(!1),this.decorateSingletonNodes(),this.updateXAxis()},t.prototype.onLayout=function(){var t=this,e=null;"vertical"===this.selectedLayout?e=tnt.tree.layout.vertical():"radial"===this.selectedLayout&&(e=tnt.tree.layout.radial()),e.width(this.WIDTH).scale(!0),this._tree.layout(e),this._tree.update(),this.updateLeafNodeHilite(!1),setTimeout(function(){return t.updateXAxis()},this.DURATION_MS)},t.prototype.onReset=function(){var t=this;this._tree.data(this.api.treeData);var e=this._rootNode=this._tree.root(),i=e.get_all_nodes(!0);_.forEach(i,function(t){t.is_collapsed()&&t.toggle()}),this.hiddenLeavesNum=0,this.rootNodeDirty=!1,this._tree.update(),this.updateLeafNodeHilite(!0),this.decorateSingletonNodes(),setTimeout(function(){t.updateXAxis(),t.updateFilter()},this.DURATION_MS)},t.prototype.onExportNewick=function(){var t=this.node.data();this.newickExport=p.parse_json(t),m(this.nodeDialogEl).dialog("close"),m("html,body").attr("scrollTop",0),new Clipboard("#newick-export button")},t.prototype.getSortOrder=function(){var t=this._tree.root().get_all_leaves();return _.map(t,function(t){return t.node_name()})},t}(),c=s(d.prototype,"familyName",[e.bindable],{enumerable:!0,initializer:null}),h=s(d.prototype,"msaEl",[e.bindable],{enumerable:!0,initializer:null}),f=s(d.prototype,"showDialog",[e.bindable],{enumerable:!0,initializer:null}),u=d))||u,t.KeysValueConverter=function(){function t(){r(this,t)}return t.prototype.toView=function(t){return Reflect.ownKeys(t)},t}()}),define("text!app.html",["module"],function(t){t.exports='<template>\n\n\t<require from="./app.css"></require>\n  <require from="resources/elements/tree"></require>\n  <require from="resources/elements/msa"></require>\n  <require from="resources/elements/taxon"></require>\n\t<require from="resources/elements/help"></require>\n\n\t<div if.bind="!api.loading">\n\t\t\x3c!--a id="help-toggle"\n\t\t\t href="#" class="button" click.delegate="toggleHelp()">\n\t\t\t<span if.bind="tools.help">&#10004;</span>\n\t\t\t<i class="fa fa-question-circle" aria-hidden="true"></i>\n\t\t\tGene Family Help\n\t\t</a--\x3e\n\t\t<a id="taxa-toggle"\n\t\t\t href="#" class="button" click.delegate="toggleTaxon()">\n\t\t\t<span if.bind="tools.taxon">&#10004;</span>\n\t\t\t<i class="fa fa-pie-chart" aria-hidden="true"></i>\n\t\t\tTaxa and Legend\n\t\t</a>\n\t\t\x3c!--a id="msa-toggle" href="#" class="button" click.delegate="toggleMSA()">\n\t\t\t<span if.bind="tools.msa">&#10004;</span>\n\t\t\t<i class="fa fa-bar-chart" aria-hidden="true"></i>\n\t\t\tMSA visualization\n\t\t</a--\x3e\n\t</div>\n\n\t<help show-dialog.two-way="tools.help"></help>\n\n\t<tree show-dialog.two-way="tools.tree"\n\t\t    family-name.one-time="familyName"\n\t\t    ref="treeEl""\n\t\t    msa-el.bind="msaEl">\n\t</tree>\n\n\t<taxon show-dialog.two-way="tools.taxon"\n\t\t     family-name.one-time="familyName">\n\t</taxon>\n\n\t<msa show-dialog.two-way="tools.msa"\n\t\t   family-name.one-time="familyName"\n\t\t   tree-el.bind="treeEl"\n\t\t   ref="msaEl">\n\t</msa>\n\n</template>\n'}),define("text!app.css",["module"],function(t){t.exports="/* override some jquery.ui dialog styles */\n\n.ui-dialog .ui-dialog-titlebar {\n\t\theight: 12px;\n}\n\n.ui-dialog-title {\n\t\tfont-size: 12px;\n\t\tline-height: 12px;\n}\n\n.ui-widget, .ui-widget button {\n\t\tfont-size: 10px;\n\t\tpadding: 2px;\n}\n\nbutton.ui-button {\n\t\tpadding: 2px;\n}"}),define("text!resources/elements/help.html",["module"],function(t){t.exports='<template>\n\t<require from="./help.css"></require>\n\t<div id="help-dialog" style="display:none">\n\t\t<p id="tour-link">\n\t\t\t<i class="fa fa-play-circle-o" aria-hidden="true"></i>\n\t\t\t<a href="#" tabindex="-1" click.delegate="onTour()">\n\t\t\t\tView quick interactive tour\n\t\t\t</a>\n\t\t</p>\n\t\t<p>\n\t\t\t<i class="fa fa-external-link" aria-hidden="true"></i>\t\t\t\n\t\t\t<a href="/search/phylotree/userinfo" target="_blank" tabindex="-1">\n\t\t\t\tView complete help on searching gene families\n\t\t\t</a>\n\t\t</p>\n\t</div>\n</template>\n'}),define("text!resources/elements/help.css",["module"],function(t){t.exports="#help-dialog p {\n\t\tfont-size: 0.8rem;\n}\n\n"}),define("text!resources/elements/taxon.css",["module"],function(t){t.exports="svg.taxon-chart {\n    width: 500px;\n    height: 214px;\n}\n\n.nv-legend-text {\n\t\tfont-size: 9px !important;\n}\n\n"}),define("text!resources/elements/loader-anim.html",["module"],function(t){t.exports='<template>\n  <i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>\n  <span class="sr-only">Loading...</span>\n</template>\n'}),define("text!resources/elements/tree.css",["module"],function(t){t.exports=".svg-container {\n\t\tmargin-bottom: 100px;\n}\n\n#au-content > tree > form > fieldset label, legend {\n    font-weight: normal;\n    display: inline;\n}\n\n#au-content > tree > form > fieldset {\n\t\tborder-width: 0;\n\t\tmargin-bottom: 0;\n\t\tmargin-top: 0;\n}\n\n.tnt_tree_node.inner circle {\n\t\tfill: white;\n}\n\n.tnt_tree_node.root circle {\n\t\tfill: dimgrey;\n}\n\n/*\n.tnt_tree_node.leaf circle {\n note: leaf nodes are dynamically styled in tree.js\n}\n*/ \n\n#node-dialog {\n\t\tfont-family: sans-serif;\n\t\tfont-size: 0.75rem;\n}\n\n.ui-dialog a {\n\t\ttext-decoration: underline;\n}\n\n.hilite-node {\n\t\tfill: yellow;\n}\n\n.axis {\n\t\tshape-rendering: crispEdges;\n}\n\n.x.axis .tick {\n\t\tfont-size: 9px;\n}\n\n.x.axis .minor {\n\t\tstroke-opacity: .5;\n}\n\n.x.axis line,\n.x.axis path {\n\t\tfill: none;\n\t\tstroke: grey;\n}\n\n\ng.singleton-node > circle {\n\t\tvisibility: hidden;\n}\n\ng.singleton-node.singleton-node-visible > circle {\n\t\tvisibility: visible;\n\t\tstroke: black;\n\t\tfill: grey;\n\t\tr: 4;\n}\n\n"}),define("text!resources/elements/msa.html",["module"],function(t){t.exports='<template>\n\t<div id="msa-dialog" ref="msaEl" style="display:none">\n\t\t<span if.bind="!api.loading && showDialog">\n\t\t\t<div class="smenubar">\n\t\t\t</div>\n\t\t\t<button class="ui-button ui-corner-all" click.delegate="onToggleMenu()">\n\t\t\t\t<i class="fa fa-bars" aria-hidden="true"></i>\n\t\t\t\t<span if.bind="! menu">Show</span>\n\t\t\t\t<span if.bind="menu">Hide</span>\n\t\t\t\tMSA Menu\n\t\t\t</button>\n\t\t\t<button class="ui-button ui-corner-all"\n\t\t\t\tdisabled.bind="! selectedFeatureNum"\n\t\t\t\tclick.delegate="onClearSelection()">\n\t\t\t\t<i class="fa fa-refresh" aria-hidden="true"></i>\n\t\t\t\tReset MSA Selection\n\t\t\t</button>\n\t\t</span>\n\t\t<div ref="msaElement">\n\t\t</div>\n\t</div>\n</template>\n'}),define("text!resources/elements/taxon.html",["module"],function(t){t.exports='<template>\n  <require from="./taxon.css"></require>\n\t<div id="taxa-dialog" ref="taxonEl" style="display:none">\n\t\t<span if.bind="!api.loading && showDialog">\n\t\t\t<button disabled.bind="! chartDirty"\n\t\t\t\tclass="ui-button ui-corner-all"\n\t\t\t\tclick.delegate="onResetChart()">\n\t\t\t\t<i class="fa fa-refresh" aria-hidden="true"></i>\n\t\t\t\tReset Taxa Selection\n\t\t\t</button>\n\t\t</span>\n\t\t<svg class="taxon-chart" ref="taxonSvgEl"></svg>\n\t</div>\n</template>\n'}),define("text!resources/elements/tree.html",["module"],function(t){t.exports='<template>\n  <require from="./tree.css"></require>\n  <require from="resources/elements/loader-anim"></require>\n\n\t<form action="" if.bind="!api.loading">\n      <fieldset>\n        <button if.bind="hiddenLeavesNum || rootNodeDirty"\n\t\t\t\t\tclass="ui-button ui-corner-all"\n\t\t\t\t\tclick.delegate="onReset()">\n\t\t\t\t\t<i class="fa fa-refresh" aria-hidden="true"></i>\n          Reset Phylogram Chart\n        </button>\n\t\t\t\t<span if.bind="hiddenLeavesNum">\n\t\t\t\t\t${hiddenLeavesNum} hidden terminal (leaf) nodes\n\t\t\t\t\t|\n\t\t\t\t</span>\n        <span if.bind="singletonNodeNum">\n          You have focused on a subtree.\n\t\t\t\t\t|\n\t\t\t\t\t<label for="singletonToggle">\n\t\t\t\t\t\t<input id="singletonToggle"\n\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\tchecked.bind="showSingletonNodes"\n\t\t\t\t\t\t\tchange.delegate="onShowSingletonNodes(showSingletonNodes)">\n\t\t\t\t\t\t<span class="label body">Show singleton nodes</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t|\n        </span>\n        <label for="verticalLayout">\n        <input id="verticalLayout" type="radio" name="layout" value="vertical"\n\t\t\t\t\tchecked.bind="selectedLayout" change.delegate="onLayout()">\n        <span class="label body">\n          vertical layout\n        </span>\n        </label>\n        <label for="radialLayout">\n        <input id="radialLayout" type="radio" name="layout" value="radial"\n          checked.bind="selectedLayout" change.delegate="onLayout()">\n        <span class="label body">\n           radial layout\n         </span>\n        </label>\n        </div>\n      </fieldset>\n  </form>\n\n\t<div if.bind="(! api.loading) && hiliteFeaturesCount"\n\t\t   style="margin-top: 10px">\n\t\tJump to hilited feature:\n\t\t<a repeat.for="name of hiliteFeatures | keys"\n\t\t\t click.delegate="onScrollToHilite(name)">\n\t\t${name}\n\t\t</a><span\n\t\t\t\tif.bind="hiliteFeaturesCount && $index < hiliteFeaturesCount -1">,\n\t\t</span>\n\t</div>\n\n\t<div id="newick-export" if.bind="newickExport">\n\t\t<h3>Newick representation of your selection\n \t\t\t<button class="ui-button ui-corner-all"\n\t\t\t\tdata-clipboard-target="#newick-code">\n\t\t\t\t<i class="fa fa-clipboard" aria-hidden="true"></i>\n\t\t\t\tCopy to clipboard\n\t\t\t</button>\n \t\t\t<button class="ui-button ui-corner-all"\n\t\t\t\tclick.delegate="newickExport=null">\n\t\t\t\t<i class="fa fa-times" aria-hidden="true"></i>\n\t\t\t\tDismiss\n\t\t\t</button>\n\t\t</h3>\n\t\t<code id="newick-code">\n     ${newickExport}\n    </code>\n\t</div>\n\n\t<div id="phylogram-axis" ref="phylogramAxisElement">\n  </div>\n\n  <div id="phylogram" style="margin-bottom: 100px; width: 800px" ref="phylogramElement">\n  </div>\n\n\t<div id="node-dialog" ref="nodeDialogEl" style="display: none">\n\t\t<div if.bind="node.is_leaf() && ! node.is_collapsed()">\n\t\t\t\x3c!-- leaf node linkouts --\x3e\n\t\t\t<div repeat.for="link of node.linkouts">\n\t\t\t\t<a href.bind="link.href" tabindex="-1">\n\t\t\t\t\t<i class="fa fa-external-link" aria-hidden="true"></i>\n\t\t\t\t\t${link.text}\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div if.bind="! node.is_leaf() || node.is_collapsed()">\n\t\t\t<div>\n\t\t\t\t<a class="link" href="#" click.delegate="onNodeToggle()" tabindex="-1">\n\t\t\t\t\t<span if.bind="node.is_collapsed()">\n\t\t\t\t\t\t<i class="fa fa-plus-square-o" aria-hidden="true"></i> Expand\n\t\t\t\t\t</span>\n\t\t\t\t\t<span if.bind="! node.is_collapsed()">\n\t\t\t\t\t\t<i class="fa fa-minus-square-o" aria-hidden="true"></i> Collapse\n\t\t\t\t\t</span>\n\t\t\t\t\tsubtree at this node\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<a class="link"\n\t\t\t\t\thref="#"\n\t\t\t\t\tif.bind="! node.is_collapsed()"\n\t\t\t\t\tclick.delegate="onNodeFocusTree()" tabindex="-1">\n\t\t\t\t\t<i class="fa fa-expand" aria-hidden="true"></i> Focus\n\t\t\t\t\ton subtree at this node\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<a class="link" href="#" click.delegate="onExportNewick()"\n\t\t\t\t\t tabindex="-1">\n\t\t\t\t\t<i class="fa fa-save" aria-hidden="true"></i>\n\t\t\t\t\tExport subtree in Newick format\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t<div if.bind="node.legumes.length">\n\t\t\t\t\x3c!-- interior node linkouts --\x3e\n\t\t\t\t<div repeat.for="link of node.linkouts">\n\t\t\t\t\t<a href.bind="link.href" tabindex="-1">\n\t\t\t\t\t\t<i class="fa fa-external-link" aria-hidden="true"></i>\n\t\t\t\t\t\t${link.text}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- cmtv link out --\x3e\n\t\t\t\t<a id="cmtv_link_out"\n\t\t\t\t\ttabindex="-1"\n\t\t\t\t\thref="http://velarde.ncgr.org:7070/isys/launch?svc=org.ncgr.cmtv.isys.CompMapViewerService%40--style%40http://velarde.ncgr.org:7070/isys/bin/Components/cmtv/conf/cmtv_combined_map_style.xml%40--combined_display%40${window.location.origin}/lis_gene_families/chado/phylo/node/gff_download/${node.data().phylonode_id}">\n\t\t\t\t\t<i class="fa fa-external-link" aria-hidden="true"></i>\n\t\t\t\t\tView Genomic Distribution for genes in this subtree\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t<div if.bind="! node.legumes.length">\n\t\t\t\t<i class="fa fa-info-circle" aria-hidden="true"></i>\n\t\t\t\t(No additional resources are available for this\n\t\t\t\tsub-tree. Please try another node.)\n\t\t\t</div>\n\t\t</div>\n\t\t<div if.bind="node.is_leaf() && ! node.is_collapsed()">\n\t\t\t\x3c!-- add a tripal organism link, if this is a leaf node and\n\t\t\torganism is known. --\x3e\n\t\t\t<div if.bind="node.data().organism_node_id">\n\t\t\t\t<a id="organism_link"\n\t\t\t\t\thref="/node/${node.data().organism_node_id}"\n\t\t\t\t\ttabindex="-1">\n\t\t\t\t\t<i class="fa fa-external-link" aria-hidden="true"></i>\n\t\t\t\t\tView organism: ${node.data().genus} ${node.data().species}\n\t\t\t\t\t<span if.bind="node.data().common_name">\n\t\t\t\t\t\t(${node.data().common_name})\n\t\t\t\t\t</span>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t\x3c!--  add a tripal feature link, if this is a leaf node and the\n\t\t\tfeature is known. --\x3e\n\t\t\t<div if.bind="node.data().feature_node_id">\n\t\t\t\t<a id="feature_link"\n\t\t\t\t\thref="/node/${node.data().feature_node_id}"\n\t\t\t\t\ttabindex="-1">\n\t\t\t\t\t<i class="fa fa-external-link" aria-hidden="true"></i>\n\t\t\t\t\tView feature: ${node.data().feature_name}\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\t\t<loader-anim if.bind="loading"></loader-anim>\n\t</div>\n\n</template>\n'});